{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://a2ui.dev/specification/v0_9/server_to_client.json",
  "title": "A2UI Message Schema",
  "description": "Describes a JSON payload for an A2UI (Agent to UI) message, which is used to dynamically construct and update user interfaces.",
  "type": "object",
  "oneOf": [
    { "$ref": "#/$defs/CreateSurfaceMessage" },
    { "$ref": "#/$defs/UpdateComponentsMessage" },
    { "$ref": "#/$defs/UpdateDataModelMessage" },
    { "$ref": "#/$defs/DeleteSurfaceMessage" },
    { "$ref": "#/$defs/WatchDataModelMessage" }
  ],
  "$defs": {
    "CreateSurfaceMessage": {
      "type": "object",
      "properties": {
        "createSurface": {
          "type": "object",
          "description": "Signals the client to create a new surface and begin rendering it. When this message is sent, the client will expect 'updateComponents' and/or 'updateDataModel' messages for the same surfaceId that define the component tree.",
          "properties": {
            "surfaceId": {
              "type": "string",
              "description": "The unique identifier for the UI surface to be rendered."
            },
            "catalogId": {
              "title": "Catalog ID",
              "description": "A string that uniquely identifies this catalog. It is recommended to prefix this with an internet domain that you own, to avoid conflicts e.g. mycompany.com:somecatalog'.",
              "type": "string"
            }
          },
          "required": ["surfaceId", "catalogId"],
          "additionalProperties": false
        }
      },
      "required": ["createSurface"],
      "additionalProperties": false
    },
    "UpdateComponentsMessage": {
      "type": "object",
      "properties": {
        "updateComponents": {
          "type": "object",
          "description": "Updates a surface with a new set of components. This message can be sent multiple times to update the component tree of an existing surface. One of the components in one of the components lists MUST have an 'id' of 'root' to serve as the root of the component tree. The createSurface message MUST have been previously sent with the 'catalogId' that is in this message.",
          "properties": {
            "surfaceId": {
              "type": "string",
              "description": "The unique identifier for the UI surface to be updated."
            },

            "components": {
              "type": "array",
              "description": "A list containing all UI components for the surface.",
              "minItems": 1,
              "items": {
                "$ref": "standard_catalog.json#/$defs/anyComponent"
              }
            }
          },
          "required": ["surfaceId", "components"],
          "additionalProperties": false
        }
      },
      "required": ["updateComponents"],
      "additionalProperties": false
    },
    "UpdateDataModelMessage": {
      "type": "object",
      "properties": {
        "updateDataModel": {
          "type": "object",
          "description": "Updates the data model for an existing surface. This message can be sent multiple times to update the data model. The createSurface message MUST have been previously sent with the 'catalogId' that is in this message.",
          "properties": {
            "surfaceId": {
              "type": "string",
              "description": "The unique identifier for the UI surface this data model update applies to."
            },
            "actorId": { "type": "string" },
            "updates": {
              "type": "array",
              "items": { "$ref": "common_types.json#/$defs/DataUpdate" }
            },
            "versions": {
              "description": "The version vector of the data model describing the state of the data model before the updates were applied.",
              "$ref": "common_types.json#/$defs/VersionVector"
            }
          },
          "required": ["surfaceId", "actorId", "updates", "versions"],
          "additionalProperties": false
        }
      },
      "required": ["updateDataModel"],
      "additionalProperties": false
    },
    "DeleteSurfaceMessage": {
      "type": "object",
      "properties": {
        "deleteSurface": {
          "type": "object",
          "description": "Signals the client to delete the surface identified by 'surfaceId'. The createSurface message MUST have been previously sent with the 'catalogId' that is in this message.",
          "properties": {
            "surfaceId": {
              "type": "string",
              "description": "The unique identifier for the UI surface to be deleted."
            }
          },
          "required": ["surfaceId"],
          "additionalProperties": false
        }
      },
      "required": ["deleteSurface"],
      "additionalProperties": false
    },
    "WatchDataModelMessage": {
      "type": "object",
      "properties": {
        "watchDataModel": {
          "type": "object",
          "description": "Configures how and when the client sends data model updates to the server for specific paths.",
          "properties": {
            "surfaceId": {
              "type": "string",
              "description": "The unique identifier for the UI surface to be configured."
            },
            "configurations": {
              "type": "array",
              "description": "A list of configuration rules for data paths.",
              "minItems": 1,
              "items": {
                "type": "object",
                "properties": {
                  "path": {
                    "type": "string",
                    "description": "The data path to configure. This applies to this path and all descendants unless overridden by a more specific path."
                  },
                  "mode": {
                    "type": "string",
                    "enum": ["onAction", "onChanged"],
                    "description": "The update mode. 'onAction' sends updates with the next user action. 'onChanged' sends updates after a quiet period."
                  },
                  "timeoutMs": {
                    "type": "integer",
                    "minimum": 0,
                    "default": 0,
                    "description": "The duration in milliseconds to wait before sending updates when in 'onChanged' mode. Defaults to 0 for immediate updates."
                  }
                },
                "required": ["path", "mode"],
                "additionalProperties": false
              }
            }
          },
          "required": ["surfaceId", "configurations"],
          "additionalProperties": false
        }
      },
      "required": ["watchDataModel"],
      "additionalProperties": false
    }
  }
}
